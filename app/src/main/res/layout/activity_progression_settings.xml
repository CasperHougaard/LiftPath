<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/fitness_background"
    android:fitsSystemWindows="true"
    tools:context=".activities.ProgressionSettingsActivity">

    <!-- Background Flow Animation -->
    <ImageView
        android:id="@+id/image_bg_animation"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:scaleType="centerCrop"
        android:alpha="1.0"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        app:srcCompat="@drawable/avd_background_flow" />

    <androidx.core.widget.NestedScrollView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="@android:color/transparent"
        android:clipToPadding="false"
        android:fillViewport="true">

        <androidx.constraintlayout.widget.ConstraintLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:clipChildren="false"
            android:clipToPadding="false"
            android:padding="24dp">

            <!-- HEADER WITH BACK BUTTON -->
            <androidx.cardview.widget.CardView
                android:id="@+id/button_back_header"
                android:layout_width="48dp"
                android:layout_height="48dp"
                android:clickable="true"
                android:focusable="true"
                android:foreground="?attr/selectableItemBackground"
                app:cardBackgroundColor="@color/fitness_card_background"
                app:cardCornerRadius="24dp"
                app:cardElevation="0dp"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toTopOf="parent">

                <ImageButton
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    android:background="@android:color/transparent"
                    android:clickable="false"
                    android:focusable="false"
                    android:contentDescription="@string/progress_back_content_description"
                    android:padding="12dp"
                    android:src="@drawable/ic_arrow_back_24"
                    app:tint="@color/fitness_text_primary" />
            </androidx.cardview.widget.CardView>

            <LinearLayout
                android:id="@+id/header_container"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginStart="16dp"
                android:gravity="center_vertical"
                android:orientation="vertical"
                app:layout_constraintBottom_toBottomOf="@id/button_back_header"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toEndOf="@id/button_back_header"
                app:layout_constraintTop_toTopOf="@id/button_back_header">

                <TextView
                    android:id="@+id/text_title"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Progression Settings"
                    android:textColor="@color/fitness_text_primary"
                    android:textSize="28sp"
                    android:textStyle="bold" />
            </LinearLayout>

            <TextView
                android:id="@+id/text_subtitle"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:text="Configure your workout progression preferences"
                android:textColor="@color/fitness_text_secondary"
                android:textSize="16sp"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toBottomOf="@id/header_container" />

            <!-- Core Settings Card -->
            <androidx.cardview.widget.CardView
                android:id="@+id/card_core_settings"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                app:cardBackgroundColor="@color/fitness_card_background"
                app:cardCornerRadius="20dp"
                app:cardElevation="4dp"
                app:layout_constraintTop_toBottomOf="@id/text_subtitle">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:padding="16dp">

                    <!-- Collapsible Header -->
                    <LinearLayout
                        android:id="@+id/header_core_settings"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="horizontal"
                        android:gravity="center_vertical"
                        android:clickable="true"
                        android:focusable="true"
                        android:foreground="?attr/selectableItemBackground"
                        android:paddingVertical="4dp">

                        <TextView
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:layout_weight="1"
                            android:text="Core Progression Settings"
                            android:textSize="16sp"
                            android:textStyle="bold"
                            android:textColor="@color/fitness_text_primary" />

                        <ImageView
                            android:id="@+id/icon_expand_core"
                            android:layout_width="24dp"
                            android:layout_height="24dp"
                            android:src="@drawable/ic_arrow_back_24"
                            android:rotation="270"
                            android:contentDescription="Expand or collapse section"
                            app:tint="@color/fitness_text_secondary" />
                    </LinearLayout>

                    <!-- Expandable Content -->
                    <LinearLayout
                        android:id="@+id/content_core_settings"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:layout_marginTop="8dp">

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:text="User Level"
                            android:textSize="14sp"
                            android:textStyle="bold"
                            android:textColor="@color/fitness_text_primary"
                            android:layout_marginBottom="8dp" />

                        <Spinner
                            android:id="@+id/spinnerUserLevel"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:padding="16dp"
                            android:background="@android:drawable/edit_text"
                            android:textColor="@color/fitness_text_primary" />

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Novice: Linear progression. Intermediate: Periodized logic."
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <com.google.android.material.textfield.TextInputLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="16dp"
                            android:hint="Lookback Sessions"
                            app:boxBackgroundMode="outline"
                            app:boxStrokeColor="@color/fitness_primary"
                            app:hintTextColor="@color/fitness_primary">

                            <com.google.android.material.textfield.TextInputEditText
                                android:id="@+id/etLookbackCount"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:inputType="number"
                                android:textColor="@color/fitness_text_primary" />
                        </com.google.android.material.textfield.TextInputLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="How many recent sessions to analyze (default: 3)"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <com.google.android.material.textfield.TextInputLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="12dp"
                            android:hint="Standard Increase (kg)"
                            app:boxBackgroundMode="outline"
                            app:boxStrokeColor="@color/fitness_primary"
                            app:hintTextColor="@color/fitness_primary">

                            <com.google.android.material.textfield.TextInputEditText
                                android:id="@+id/etIncreaseStep"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:inputType="numberDecimal"
                                android:textColor="@color/fitness_text_primary" />
                        </com.google.android.material.textfield.TextInputLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Weight increase when feeling easy (default: 2.5kg)"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <com.google.android.material.textfield.TextInputLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="12dp"
                            android:hint="Small Increase (kg)"
                            app:boxBackgroundMode="outline"
                            app:boxStrokeColor="@color/fitness_primary"
                            app:hintTextColor="@color/fitness_primary">

                            <com.google.android.material.textfield.TextInputEditText
                                android:id="@+id/etSmallStep"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:inputType="numberDecimal"
                                android:textColor="@color/fitness_text_primary" />
                        </com.google.android.material.textfield.TextInputLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Smaller increment for moderate RPE (default: 1.25kg)"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                    </LinearLayout>
                </LinearLayout>
            </androidx.cardview.widget.CardView>

            <!-- Rest Timer Settings Card -->
            <androidx.cardview.widget.CardView
                android:id="@+id/card_rest_timer"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="12dp"
                app:cardBackgroundColor="@color/fitness_card_background"
                app:cardCornerRadius="20dp"
                app:cardElevation="4dp"
                app:layout_constraintTop_toBottomOf="@id/card_core_settings">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:padding="16dp">

                    <!-- Collapsible Header -->
                    <LinearLayout
                        android:id="@+id/header_rest_timer"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="horizontal"
                        android:gravity="center_vertical"
                        android:clickable="true"
                        android:focusable="true"
                        android:foreground="?attr/selectableItemBackground"
                        android:paddingVertical="4dp">

                        <TextView
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:layout_weight="1"
                            android:text="⏱️ Rest Timer"
                            android:textSize="16sp"
                            android:textStyle="bold"
                            android:textColor="@color/fitness_text_primary" />

                        <androidx.appcompat.widget.SwitchCompat
                            android:id="@+id/switchRestTimer"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:layout_marginEnd="8dp" />

                        <ImageView
                            android:id="@+id/icon_expand_rest_timer"
                            android:layout_width="24dp"
                            android:layout_height="24dp"
                            android:src="@drawable/ic_arrow_back_24"
                            android:rotation="270"
                            android:contentDescription="Expand or collapse section"
                            app:tint="@color/fitness_text_secondary" />
                    </LinearLayout>

                    <TextView
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="Auto-start rest timer after logging sets"
                        android:textSize="12sp"
                        android:textColor="@color/fitness_text_secondary" />

                    <!-- Expandable Content -->
                    <LinearLayout
                        android:id="@+id/content_rest_timer"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="12dp"
                        android:orientation="vertical">

                        <LinearLayout
                            android:id="@+id/layoutRestTimerSettings"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="vertical">

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:hint="Heavy Rest (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etHeavyRest"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Rest time for heavy/strength workouts (default: 150s / 2.5min)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="12dp"
                                android:hint="Light Rest (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etLightRest"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Rest time for light/volume workouts (default: 60s / 1min)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="12dp"
                                android:hint="Custom Rest (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etCustomRest"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Rest time for custom workouts (default: 120s / 2min)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />
                        </LinearLayout>

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="16dp"
                            android:orientation="horizontal"
                            android:gravity="center_vertical">

                            <TextView
                                android:layout_width="0dp"
                                android:layout_height="wrap_content"
                                android:layout_weight="1"
                                android:text="Live Countdown in Notification"
                                android:textSize="16sp"
                                android:textStyle="bold"
                                android:textColor="@color/fitness_text_primary" />

                            <androidx.appcompat.widget.SwitchCompat
                                android:id="@+id/switchNotificationLiveCountdown"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content" />
                        </LinearLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Show live countdown timer in notification (e.g., 2:30 remaining)"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="16dp"
                            android:orientation="horizontal"
                            android:gravity="center_vertical">

                            <TextView
                                android:layout_width="0dp"
                                android:layout_height="wrap_content"
                                android:layout_weight="1"
                                android:text="Auto-Dismiss Notification"
                                android:textSize="16sp"
                                android:textStyle="bold"
                                android:textColor="@color/fitness_text_primary" />

                            <androidx.appcompat.widget.SwitchCompat
                                android:id="@+id/switchNotificationAutoDismiss"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content" />
                        </LinearLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Automatically dismiss the completion notification after a set time"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <LinearLayout
                            android:id="@+id/layoutNotificationAutoDismissSettings"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="12dp"
                            android:orientation="vertical">

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:hint="Auto-Dismiss Time (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etNotificationAutoDismiss"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="How long the completion notification stays visible before auto-dismissing (default: 10 seconds)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />
                        </LinearLayout>

                        <LinearLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="16dp"
                            android:orientation="horizontal"
                            android:gravity="center_vertical">

                            <TextView
                                android:layout_width="0dp"
                                android:layout_height="wrap_content"
                                android:layout_weight="1"
                                android:text="RPE-Based Adjustment"
                                android:textSize="16sp"
                                android:textStyle="bold"
                                android:textColor="@color/fitness_text_primary" />

                            <androidx.appcompat.widget.SwitchCompat
                                android:id="@+id/switchRpeAdjustment"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content" />
                        </LinearLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Add extra rest time for high RPE sets"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <LinearLayout
                            android:id="@+id/layoutRpeAdjustmentSettings"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="12dp"
                            android:orientation="vertical">

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:hint="High RPE Threshold"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etRpeThreshold"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="numberDecimal"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Sets with RPE ≥ this value get bonus rest (default: 9.0)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="12dp"
                                android:hint="Bonus Rest (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etRpeBonus"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Extra rest added for high RPE sets (default: 60s)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="16dp"
                                android:text="RPE Deviation Adjustment"
                                android:textSize="16sp"
                                android:textStyle="bold"
                                android:textColor="@color/fitness_text_primary" />

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Adjust rest time based on logged RPE vs suggested RPE"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="12dp"
                                android:hint="RPE Deviation Threshold"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etRpeDeviationThreshold"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="numberDecimal"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="RPE difference threshold to trigger adjustment (default: 1.0)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="12dp"
                                android:hint="Positive Adjustment (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etRpePositiveAdjustment"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Add seconds when logged RPE ≥ suggested + threshold (default: 30s)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />

                            <com.google.android.material.textfield.TextInputLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="12dp"
                                android:hint="Negative Adjustment (seconds)"
                                app:boxBackgroundMode="outline"
                                app:boxStrokeColor="@color/fitness_primary"
                                app:hintTextColor="@color/fitness_primary">

                                <com.google.android.material.textfield.TextInputEditText
                                    android:id="@+id/etRpeNegativeAdjustment"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:inputType="number"
                                    android:textColor="@color/fitness_text_primary" />
                            </com.google.android.material.textfield.TextInputLayout>

                            <TextView
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Subtract seconds when logged RPE ≤ suggested - threshold (default: 15s)"
                                android:textSize="12sp"
                                android:textColor="@color/fitness_text_secondary" />
                        </LinearLayout>

                        <!-- RPE & Timing Info Card -->
                        <androidx.cardview.widget.CardView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="16dp"
                            app:cardBackgroundColor="@color/fitness_accent"
                            app:cardCornerRadius="12dp"
                            app:cardElevation="2dp">

                            <LinearLayout
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:orientation="vertical"
                                android:padding="16dp">

                                <TextView
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:text="⏱️ How Rest Timer Works"
                                    android:textSize="16sp"
                                    android:textStyle="bold"
                                    android:textColor="@color/white" />

                                <TextView
                                    android:id="@+id/textRpeSuggestions"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="12dp"
                                    android:text="Suggested RPE values:\n• Heavy: Novice 8.0, Intermediate 8.5\n• Light: Novice 7.0, Intermediate 7.5"
                                    android:textSize="13sp"
                                    android:textColor="@color/white"
                                    android:lineSpacingExtra="4dp" />

                                <TextView
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="12dp"
                                    android:text="Timer Calculation:"
                                    android:textSize="14sp"
                                    android:textStyle="bold"
                                    android:textColor="@color/white" />

                                <TextView
                                    android:id="@+id/textTimerCalculation"
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="8dp"
                                    android:text="1. Start with base rest time (Heavy/Light/Custom)\n2. If RPE ≥ High Threshold: +Bonus seconds\n3. If logged RPE ≥ suggested+threshold: +Positive adjustment\n4. If logged RPE ≤ suggested-threshold: -Negative adjustment"
                                    android:textSize="12sp"
                                    android:textColor="@color/white"
                                    android:lineSpacingExtra="2dp" />

                                <TextView
                                    android:layout_width="match_parent"
                                    android:layout_height="wrap_content"
                                    android:layout_marginTop="12dp"
                                    android:text="Example: Heavy workout, Intermediate, logged RPE 9.5\nBase: 150s + High RPE bonus (9.5≥9.0): +60s + Deviation (9.5-8.5=1.0): +30s = 240s total"
                                    android:textSize="11sp"
                                    android:textColor="@color/white"
                                    android:fontFamily="monospace"
                                    android:lineSpacingExtra="2dp" />
                            </LinearLayout>
                        </androidx.cardview.widget.CardView>
                    </LinearLayout>
                </LinearLayout>
            </androidx.cardview.widget.CardView>

            <!-- Deload Settings Card -->
            <androidx.cardview.widget.CardView
                android:id="@+id/card_deload"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="12dp"
                app:cardBackgroundColor="@color/fitness_card_background"
                app:cardCornerRadius="20dp"
                app:cardElevation="4dp"
                app:layout_constraintTop_toBottomOf="@id/card_rest_timer">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:padding="16dp">

                    <!-- Collapsible Header -->
                    <LinearLayout
                        android:id="@+id/header_deload"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="horizontal"
                        android:gravity="center_vertical"
                        android:clickable="true"
                        android:focusable="true"
                        android:foreground="?attr/selectableItemBackground"
                        android:paddingVertical="4dp">

                        <TextView
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:layout_weight="1"
                            android:text="⚠️ Deload Detection"
                            android:textSize="16sp"
                            android:textStyle="bold"
                            android:textColor="@color/fitness_text_primary" />

                        <ImageView
                            android:id="@+id/icon_expand_deload"
                            android:layout_width="24dp"
                            android:layout_height="24dp"
                            android:src="@drawable/ic_arrow_back_24"
                            android:rotation="270"
                            android:contentDescription="Expand or collapse section"
                            app:tint="@color/fitness_text_secondary" />
                    </LinearLayout>

                    <TextView
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="Recommends recovery weeks when you've had too many hard sessions"
                        android:textSize="12sp"
                        android:textColor="@color/fitness_text_secondary" />

                    <!-- Expandable Content -->
                    <LinearLayout
                        android:id="@+id/content_deload"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="12dp"
                        android:orientation="vertical">

                        <com.google.android.material.textfield.TextInputLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:hint="Consecutive Hard Sessions"
                            app:boxBackgroundMode="outline"
                            app:boxStrokeColor="@color/fitness_primary"
                            app:hintTextColor="@color/fitness_primary">

                            <com.google.android.material.textfield.TextInputEditText
                                android:id="@+id/etDeloadThreshold"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:inputType="number"
                                android:textColor="@color/fitness_text_primary" />
                        </com.google.android.material.textfield.TextInputLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Trigger deload after N hard sessions (default: 3)"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                        <com.google.android.material.textfield.TextInputLayout
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="12dp"
                            android:hint="High RPE Threshold"
                            app:boxBackgroundMode="outline"
                            app:boxStrokeColor="@color/fitness_primary"
                            app:hintTextColor="@color/fitness_primary">

                            <com.google.android.material.textfield.TextInputEditText
                                android:id="@+id/etDeloadRPE"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:inputType="numberDecimal"
                                android:textColor="@color/fitness_text_primary" />
                        </com.google.android.material.textfield.TextInputLayout>

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="What counts as 'hard' (default: 9.0)"
                            android:textSize="12sp"
                            android:textColor="@color/fitness_text_secondary" />

                    </LinearLayout>
                </LinearLayout>
            </androidx.cardview.widget.CardView>

            <!-- Action Buttons -->
            <LinearLayout
                android:id="@+id/layout_buttons"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="24dp"
                android:layout_marginBottom="24dp"
                android:orientation="horizontal"
                android:baselineAligned="false"
                app:layout_constraintTop_toBottomOf="@id/card_deload">

                <androidx.cardview.widget.CardView
                    android:id="@+id/btnResetDefaults"
                    android:layout_width="0dp"
                    android:layout_height="60dp"
                    android:layout_weight="1"
                    android:layout_marginEnd="8dp"
                    android:clickable="true"
                    android:focusable="true"
                    android:foreground="?attr/selectableItemBackground"
                    app:cardBackgroundColor="@color/fitness_card_background"
                    app:cardCornerRadius="20dp"
                    app:cardElevation="2dp">

                    <TextView
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:gravity="center"
                        android:text="Reset to Defaults"
                        android:textColor="@color/fitness_text_primary"
                        android:textSize="16sp"
                        android:textStyle="bold" />
                </androidx.cardview.widget.CardView>

                <androidx.cardview.widget.CardView
                    android:id="@+id/btnSave"
                    android:layout_width="0dp"
                    android:layout_height="60dp"
                    android:layout_weight="1"
                    android:layout_marginStart="8dp"
                    android:clickable="true"
                    android:focusable="true"
                    android:foreground="?attr/selectableItemBackground"
                    app:cardBackgroundColor="@color/fitness_primary"
                    app:cardCornerRadius="20dp"
                    app:cardElevation="4dp">

                    <TextView
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:gravity="center"
                        android:text="Save Settings"
                        android:textColor="@color/white"
                        android:textSize="16sp"
                        android:textStyle="bold" />
                </androidx.cardview.widget.CardView>
            </LinearLayout>

        </androidx.constraintlayout.widget.ConstraintLayout>
    </androidx.core.widget.NestedScrollView>
</androidx.constraintlayout.widget.ConstraintLayout>